From 39271e971ee030e1f2e1b03d548f44f265997a43 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Sat, 7 Sep 2024 20:19:44 +0800
Subject: [PATCH] qmdmodel.cpp: fix code for Qt < 5.11

Fixes a breakage introduced by https://github.com/linux-minidisc/linux-minidisc/commit/14444a75cf7d57f3cd01d578119a70ee925899b6
Closes: https://github.com/linux-minidisc/linux-minidisc/issues/96
---
 qhimdtransfer/qmdmodel.cpp | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git qhimdtransfer/qmdmodel.cpp qhimdtransfer/qmdmodel.cpp
index 7206e89..c9ec299 100644
--- qhimdtransfer/qmdmodel.cpp
+++ qhimdtransfer/qmdmodel.cpp
@@ -1,5 +1,6 @@
 #include <QFont>
 #include <QFontMetrics>
+#include <QtGlobal>
 #include <qmdmodel.h>
 
 enum hcolumnum {
@@ -26,11 +27,19 @@ QVariant QNetMDTracksModel::headerData(int section, Qt::Orientation orientation,
         switch((ncolumnum)section)
         {
             case CoId:
+#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)
                 return QSize(met.horizontalAdvance("9999")+5, 0);
+#else
+                return QSize(met.width("9999")+5, 0);
+#endif
             case CoGroup:
             case CoTitle:
             case CoLength:
+#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)
                 return QSize(met.horizontalAdvance("9:99:99"), 0);
+#else
+                return QSize(met.width("9:99:99"), 0);
+#endif
             case CoCodec:
             case CoUploadable:
                 /* Really use the header for the metric in these columns,
@@ -175,20 +184,32 @@ QVariant QHiMDTracksModel::headerData(int section, Qt::Orientation orientation,
         switch((hcolumnum)section)
         {
             case ColId:
+#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)
                 return QSize(met.horizontalAdvance("9999")+5, 0);
+#else
+                return QSize(met.width("9999")+5, 0);
+#endif
             case ColTitle:
             case ColArtist:
             case ColAlbum:
                 return QSize(25*met.averageCharWidth(), 0);
             case ColLength:
+#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)
                 return QSize(met.horizontalAdvance("9:99:99"), 0);
+#else
+                return QSize(met.width("9:99:99"), 0);
+#endif
             case ColCodec:
             case ColUploadable:
                 /* Really use the header for the metric in these columns,
                    contents will be shorter */
                 return QAbstractListModel::headerData(section,orientation,role);
             case ColRecDate:
+#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)
                 return QSize(met.horizontalAdvance("yyyy.MM.dd hh:mm:ss"), 0);
+#else
+                return QSize(met.width("yyyy.MM.dd hh:mm:ss"), 0);
+#endif
         }
     }
 
-- 
2.46.0

